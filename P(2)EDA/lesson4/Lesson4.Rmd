---
title: "Lesson4"
author: "Beltino Goncalves"
date: "October 24, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

#Data Dimonds
##Quiiz1 Answers
```{r diamonds}
data("diamonds")

summary(diamonds)
str(diamonds)
?diamonds
```

##Quiz: Price Histogram

```{r}
library(ggplot2)

ggplot(diamonds,aes(price))+geom_histogram()


summary(diamonds$price)
```
As it appears, the price histogram has a long tail distribution, which is shifted towards the left closer to the diamond price of zero. The median price of the diamond is $2401, while the price average is $3933. The max paid for a diamond was $18823, while the lowest $326. About 53,940 data count is contanied our this dataset.

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

### How many diamonds cost less than $500?
```{r}
subset(diamonds,price <500)

sum(diamonds$price <500)
```
### How many diamonds cost less than $250?
```{r}
subset(diamonds,price <250)
sum(diamonds$price <250)
```
### How many diamonds cost $15000 or more?
```{r}
subset(diamonds,price >= 15000)

sum(diamonds$price >=15000)
```

## Explore the largest peak in the price histogram
```{r}
ggplot(diamonds,aes(price))+
  geom_freqpoly(aes(color = price), binwidth=80)+
  scale_x_continuous(limits= c(0,2000), breaks = c(0,2000,100))

```
There no diamonds that cost $1500. For diamonds that cost less than $2,000. the most price of diamond is around $700 with the mode being $605.

### Getting the mode
```{r}
# Create the function.
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}
mean(diamonds$price)

getmode(diamonds$price)
```

### Price by Cut Histogram 
```{r}
levels(diamonds$cut)

#We have to order the geom

ggplot(diamonds,aes(x=price)) + geom_histogram()+ facet_wrap(~cut)+ scale_x_continuous(limits=c())

```
## Exploration on the cut prices 
```{r}
summary(diamonds$cut)
ggplot(aes(x = cut, y=price, fill=cut), data = diamonds) + geom_boxplot() + scale_y_continuous(limits=c(0,390))


#Which cut has the highest priced diamonds?
#Which cute has the lowest priced diamonds?
#Which cut has the lowest median price?
by(diamonds$price,diamonds$cut,max)
by(diamonds$price,diamonds$cut,min)
by(diamonds$price,diamonds$cut,median)
ggplot(aes(x = cut, y=price, fill=cut), data = diamonds) + geom_boxplot() + scale_y_continuous(limits=c())

```
## Scales and Multiple Histogram
```{r}
# Run the code below in R Studio to generate
# the histogram as a reminder.

# ===============================================================
qplot(x = price, data = diamonds) + facet_wrap(~cut)

# ===============================================================

# In the last exercise, we looked at the summary statistics
# for diamond price by cut. If we look at the output table, the
# the median and quartiles are reasonably close to each other.
by(diamonds$price,diamonds$cut,summary)


# This means the distributions should be somewhat similar,
# but the histograms we created don't show that.

# The 'Fair' and 'Good' diamonds appear to have 
# different distributions compared to the better
# cut diamonds. They seem somewhat uniform
# on the left with long tails on the right.

# Let's look in to this more.
qplot(x = price, data = diamonds) + facet_wrap(~cut, scales="free_y")
# Look up the documentation for facet_wrap in R Studio.
# Then, scroll back up and add a parameter to facet_wrap so that
# the y-axis in the histograms is not fixed. You want the y-axis to
# be different for each histogram.
#http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/



```

## Price per Carat by Cut
```{r}
# Create a histogram of price per carat
# and facet it by cut. You can make adjustments
# to the code from the previous exercise to get
# started.

# Adjust the bin width and transform the scale
# of the x-axis using log10.

# Submit your final code when you are ready.

# ENTER YOUR CODE BELOW THIS LINE.
# ===========================================================================

ggplot(diamonds,aes(x=price/carat)) + geom_histogram()+ facet_wrap(~cut, scales="free_y")+ scale_x_log10()



```


## Price Box Plots - Clarity
```{r}
data("diamonds")
colnames(diamonds)
summary(diamonds$clarity)
### BOXPLOTS BY CLARITY

diamonds$clarity <- ordered(diamonds$clarity, level=c("I1" , "SI1", "SI2", "VS1","VS2","VVS1","VVS2", "IF" ))

ggplot(diamonds,aes(x=clarity, y=price, fill=clarity)) + geom_boxplot() + scale_y_sqrt()

by(diamonds$price, diamonds$clarity, summary)

```
The clarity boxplot is very insightfull. It indicates that diamonds who had perfect 'IF'(Best) were on average where sold very cheap as people would perceive them to be fake because they are perfectly clear. While on the other hand diamonds who were Classified as I1(worst cleaderly) which would IQR are among the best getting a fair price on a diamond and it would be less likley to get damaged if the it was IF depending on the cut. In my opion pick the clearity SI2, where the the median amount paid to the diamond is among the highest. And you get the both clearidy, but more worst clearidy, which can also make the diamond to be perceived as fake.

##### Price Box Plots - color
```{r}

data(diamonds) 
summary(diamonds$color)

ggplot(diamonds,aes(x=color, y=price, fill=color)) + geom_boxplot() + scale_y_sqrt()

by(diamonds$price, diamonds$color, summary)
```

The box plots for Color indicates that diamond who's colors are J(WORST) are among of the diamonds whos median has the heights price sold at $4,234. This would agree with above statement that the worst color in diamonds sometimes can be good for the human perception to thinking that the diamond is fake and would be less likely for it to be stolen. But since we leave in a materialistic world, D color is the best. Which make me wonder what would be the price of Color D and with SI2, which perfect cut.

### Price Box Plot - Cut
```{r}
summary(diamonds$cut)

ggplot(diamonds,aes(x=cut, y=price, fill=cut)) + geom_boxplot() + scale_y_sqrt()

by(diamonds$price, diamonds$cut, summary)
```
Diamonds who were sold as a fair cut, had the highiest median price at $3282. This make me wonder if you add Clarity of SI2, with a J color and Cut of Fair. What would be an optimal price? Which this would involve multiple varables to be taken into consideration for our analysis. 


### Interquartile Range -IQR
```{r}
?diamonds

by(diamonds$price, diamonds$color, IQR)

```
### Price per Carat Box Plots by Color
```{r}
ggplot(diamonds, aes(x=color,y=price/carat)) + geom_boxplot()

```


###Carat Frequency Polygon
```{r}
# Investigate the weight of the diamonds (carat) using a frequency polygon. Use different bin widtg to see how the frequency polygon changes. What carat size has a count greater than 2000?


ggplot(aes(x = carat),
       data =diamonds ) +
  geom_freqpoly(binwidth=.1)+  scale_x_continuous(limits = c(0,3),breaks = seq(0,3,0.25)) 
table(diamonds$carat)

```

# Gapminder Data
```{r}
# The Gapminder website contains over 500 data sets with information about
# the world's population. Your task is to download a data set of your choice
# and create 2-5 plots that make use of the techniques from Lesson 3.

##http://www.gapminder.org/data/

# I am going to Replicate what Hans Roslings in his video
# "200 Countries, 200 Years, 4 Minutes"

#Download these packages for data wrangling
install.packages("devtools")
install.packages("tidyr")
install.packages("dplyr")
install.packages('openxlsx')
install.packages('res')
library(dplyr) 
library(devtools)
library(tidyr)
library(openxlsx)
library(reshape)
````
## Reading the excel files. 
```{r}
d1 <- read.xlsx('indicator gapminder gdp_per_capita_ppp.xlsx')

d2 <- read.xlsx("indicator life_expectancy_at_birth.xlsx")
```


## Melt and Merge the data
```{r}
#Melting the dataset
d1<-melt(d1, id=c("GDP.per.capita"))
d2<-melt(d2, id=c("Life.expectancy"))

#Change Column names
d1<-rename(d1, c("GDP.per.capita"="country","variable"="year","value"="GDPperIncome"))
d2<-rename(d2, c("Life.expectancy"="country","variable"="year","value"="life.expectancy"))
head(d2)

#Merging the dataset
df=merge(d1,d2, c("country","year"))
tail(df)
```


## Visualization for relatives Life Expectancy based on Country
```{r}
library(ggplot2)

colnames(df)
str(df)

#converting String to numbers
df$year<-as.numeric(as.character(df$year))

# Picking all the countries where I have relatives 
ggplot(data=subset(df,country %in% c("Cape Verde","United States","Luxembourg","Angola","Switzerland","Sweden")),aes(x=year,y=life.expectancy,fill=country)) + 
  geom_line(aes(color=country)) +
  scale_x_continuous(limits = c(1992,2015), breaks = c(1992,2015,7)) +
  facet_wrap(~country, scales = "free_y")+
  scale_y_continuous(limits = c(40,85))+
  ylab("Life Expectancy") +
  xlab("Date")

```



## Visualization of Relatives GDP per Capita based on Country
```{r}

df1<-subset(df,country %in% c("Cape Verde","United States","Luxembourg","Angola","Switzerland","Sweden"))

ggplot(data=df1,aes(x=year,y=GDPperIncome,fill=country)) + 
  geom_line(aes(color=country)) + 
  scale_x_continuous(limits = c(1992,2015))

```
For my relatives whom lives in Luxembourg life got to be pretty good. :)

## Visualization of Both 
```{r}
#install.packages('plotly')
library(plotly)
## devtools::install_github('hadley/ggplot2')


p <- ggplot(data=df1,aes(x=life.expectancy,y=GDPperIncome,fill=country)) + 
  geom_point(aes(color=country),)

p<-ggplotly(p)
p
devtools::install_github('hadley/ggplot2')
```

## Visualization Of Boxplot
```{r}

df$country<-as.factor(df$country)

ggplot(data=subset(df,country %in% c("Cape Verde","United States","Luxembourg","Angola","Switzerland","Sweden")),aes(x=life.expectancy,y=GDPperIncome,fill=country)) + 
  geom_boxplot(aes(color=country),)+facet_wrap(~country, scales="free") +
  scale_x_continuous(limits=c(0,80),breaks = c(0,80,10))
```
```{r}
df1<-subset(df,country %in% c("Cape Verde","United States","Luxembourg","Angola","Switzerland","Sweden")


##Which country has the highest life expentancy
by(df1$life.expectancy,df1$country,max)
##Which country has the lowest life expentancy
by(df1$life.expectancy,df1$country,min)
#Summary abou the countries 
by(df1$life.expectancy,df1$country,summary)




```

## Visualization of the life expectancy of Cape Verde
```{r}
ggplot(data=df,aes(x=GDPperIncome,y=life.expectancy))+    geom_point(aes(colour = year)) +
  scale_x_log10() 
```

# 